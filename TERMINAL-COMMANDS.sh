#!/bin/bash

# ═══════════════════════════════════════════════════════════════
# PWA Деплой - Команди для терміналу
# ═══════════════════════════════════════════════════════════════

echo "🚀 Початок деплою PWA на GitHub Pages"
echo ""

# ───────────────────────────────────────────────────────────────
# ШАГ 1: Перевірка іконок
# ───────────────────────────────────────────────────────────────
echo "📋 ШАГ 1: Перевірка PNG іконок..."
echo ""

if [ ! -f "public/icon-128x128.png" ] || \
   [ ! -f "public/icon-152x152.png" ] || \
   [ ! -f "public/icon-180x180.png" ] || \
   [ ! -f "public/icon-192x192.png" ] || \
   [ ! -f "public/icon-512x512.png" ]; then
    echo "❌ ПОМИЛКА: PNG іконки не знайдені!"
    echo ""
    echo "🎨 Згенеруйте іконки:"
    echo "   1. Відкрийте у браузері: public/generate-icons.html"
    echo "   2. Натисніть: 'Завантажити всі іконки'"
    echo "   3. Скопіюйте 5 PNG файлів у папку /public"
    echo ""
    echo "Потім запустіть цей скрипт знову."
    exit 1
else
    echo "✅ Всі іконки знайдені:"
    ls -lh public/icon-*.png | awk '{print "   ✓", $9, "(" $5 ")"}'
    echo ""
fi

# ───────────────────────────────────────────────────────────────
# ШАГ 2: Перевірка Git статусу
# ───────────────────────────────────────────────────────────────
echo "📋 ШАГ 2: Перевірка змін Git..."
echo ""

git status --short

echo ""
read -p "❓ Закомітити ці зміни? (y/n) " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "❌ Деплой скасовано."
    exit 1
fi

# ───────────────────────────────────────────────────────────────
# ШАГ 3: Додати файли
# ───────────────────────────────────────────────────────────────
echo ""
echo "📋 ШАГ 3: Додавання файлів..."
git add .
echo "✅ Файли додано"

# ───────────────────────────────────────────────────────────────
# ШАГ 4: Створити коміт
# ───────────────────────────────────────────────────────────────
echo ""
echo "📋 ШАГ 4: Створення коміту..."

COMMIT_MESSAGE="feat: PWA готовий до деплою на GitHub Pages

✅ Виправлено шляхи в index.html (відносні)
✅ Виправлено manifest.json (абсолютні /Rezerv/)
✅ Виправлено app.js (автовизначення base URL)
✅ Додано GitHub Actions workflow
✅ Згенеровано 5 PNG іконок
✅ Створено повні інструкції для деплою

Тепер PWA готовий до публікації на:
https://katywenkatwins.github.io/Rezerv/"

git commit -m "$COMMIT_MESSAGE"
echo "✅ Коміт створено"

# ───────────────────────────────────────────────────────────────
# ШАГ 5: Push на GitHub
# ───────────────────────────────────────────────────────────────
echo ""
echo "📋 ШАГ 5: Відправка на GitHub..."
git push origin main

if [ $? -eq 0 ]; then
    echo "✅ Push успішний!"
else
    echo "❌ Помилка push. Перевірте підключення до GitHub."
    exit 1
fi

# ───────────────────────────────────────────────────────────────
# ШАГ 6: Інформація про наступні кроки
# ───────────────────────────────────────────────────────────────
echo ""
echo "═══════════════════════════════════════════════════════════"
echo "🎉 Файли відправлені на GitHub!"
echo "═══════════════════════════════════════════════════════════"
echo ""
echo "📋 НАСТУПНІ КРОКИ:"
echo ""
echo "1. 🔄 Зачекайте на GitHub Actions (2-3 хвилини)"
echo "   https://github.com/katywenkatwins/Rezerv/actions"
echo ""
echo "2. ✅ Перевірте що деплой завершився успішно (зелена галочка)"
echo ""
echo "3. 🌐 Відкрийте сайт:"
echo "   https://katywenkatwins.github.io/Rezerv/"
echo ""
echo "4. 🔍 Перевірте PWA (DevTools → F12):"
echo "   - Application → Manifest (іконки повинні бути)"
echo "   - Application → Service Workers (activated)"
echo "   - Console (немає помилок)"
echo ""
echo "5. 📱 Встановіть PWA:"
echo "   - Desktop: іконка 'Встановити' у адресному рядку"
echo "   - Mobile: Меню → 'Додати на головний екран'"
echo ""
echo "═══════════════════════════════════════════════════════════"
echo ""
echo "📚 Докладні інструкції:"
echo "   - QUICK-START.md"
echo "   - ГОТОВО-ДО-ДЕПЛОЮ.md"
echo "   - FINAL-DEPLOYMENT-CHECKLIST.md"
echo ""
echo "🐛 Якщо щось не працює:"
echo "   - Перевірте логи GitHub Actions"
echo "   - Очистіть кеш браузера (Ctrl+Shift+Del)"
echo "   - Зробіть Hard Refresh (Ctrl+Shift+R)"
echo ""
echo "═══════════════════════════════════════════════════════════"
echo ""
echo "✅ Деплой завершено! Хорошого дня! 🚀"
echo ""
